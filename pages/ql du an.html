<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω d·ª± √°n</title>
    <link rel="stylesheet" href="../css/pages/dashboard.css">
    <link rel="stylesheet" href="../css/components/header.css">
    <link rel="stylesheet" href="../css/components/sidebar.css">
    <link rel="stylesheet" href="../css/main.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar Toggle Button -->
        <button id="sidebar-toggle" class="sidebar-toggle-btn">
            <span id="sidebar-toggle-icon">‚ò∞</span>
        </button>
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header" style="white-space: nowrap; display: flex; align-items: center; gap: 8px;">
                <h2 style="white-space: nowrap; font-size: 22px; margin: 0;">Qu·∫£n l√≠ LAB</h2>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><span class="icon">üè†</span> <a href="trang chu.html" style="text-decoration:none; color:inherit;">Trang ch·ªß</a></li>
                    <li><span class="icon">üë§</span> <a href="ql nguoi dung.html" style="text-decoration:none; color:inherit;">Nh√¢n vi√™n</a></li>
                    <li><span class="icon">üñ•Ô∏è</span> <a href="trang ql thi·∫øt b·ªã.html" style="text-decoration:none; color:inherit;">Thi·∫øt b·ªã</a></li>
                    <li class="active"><span class="icon">üìÅ</span> <a href="ql du an.html" style="text-decoration:none; color:inherit;">D·ª± √°n</a></li>
                    <li><span class="icon">üîÑ</span> <a href="muonthietbi.html" style="text-decoration:none; color:inherit;">M∆∞·ª£n thi·∫øt b·ªã</a></li>
                </ul>
                <div class="sidebar-bottom">
                    <ul>
                        <li><span class="icon">‚öôÔ∏è</span> C√†i ƒë·∫∑t</li>
                        <li><span class="icon">üîì</span> ƒêƒÉng xu·∫•t</li>
                    </ul>
                </div>
            </nav>
        </aside>
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left"></div>
                <div class="header-right">
                    <span class="icon">üîî</span>
                    <span class="user-info">
                        <img src="https://randomuser.me/api/portraits/women/68.jpg" alt="avatar" class="avatar">
                        <span>Ki√™n </span>
                        <span class="role">Admin</span>
                    </span>
                </div>
            </header>
            <!-- Project Management Content -->
            <section class="dashboard">
                <h1>Qu·∫£n l√Ω d·ª± √°n</h1>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px;">
                    <h2 style="margin: 0;">Danh s√°ch d·ª± √°n</h2>
                    <button class="btn-detail" id="btn-add-project">+ Th√™m d·ª± √°n</button>
                </div>
                <table class="project-table" id="project-table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>T√™n d·ª± √°n</th>
                            <th>B·∫Øt ƒë·∫ßu</th>
                            <th>K·∫øt th√∫c</th>
                            <th>Ti·∫øn ƒë·ªô</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="project-table-body">
                        <!-- D·ªØ li·ªáu m·∫´u s·∫Ω ƒë∆∞·ª£c render b·∫±ng JS -->
                    </tbody>
                </table>
                <!-- Pagination Footer -->
                <div id="project-pagination-footer" style="display:flex; align-items:center; justify-content:space-between; margin-top:12px;">
                    <div id="project-page-info" style="font-weight:500;">Trang 1/1</div>
                    <div>
                        <button id="btn-project-prev-page" class="btn-detail" style="min-width:36px; padding:4px 0;">&lt;</button>
                        <button id="btn-project-next-page" class="btn-detail" style="min-width:36px; padding:4px 0;">&gt;</button>
                    </div>
                </div>
            </section>
            <!-- Modal Th√™m/S·ª≠a d·ª± √°n -->
            <div id="project-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.2); align-items:center; justify-content:center; z-index:2000;">
                <form id="project-form" style="background:#fff; padding:32px 24px; border-radius:12px; min-width:320px; max-width:90vw; box-shadow:0 2px 16px rgba(0,0,0,0.12); display:flex; flex-direction:column; gap:16px;">
                    <h3 id="project-modal-title">Th√™m d·ª± √°n</h3>
                    <input type="text" id="project-name" placeholder="T√™n d·ª± √°n" required>
                    <input type="date" id="project-start" required>
                    <input type="date" id="project-end" required>
                    <input type="number" id="project-progress" min="0" max="100" placeholder="Ti·∫øn ƒë·ªô (%)" required>
                    <select id="project-status">
                        <option value="ƒêang th·ª±c hi·ªán">ƒêang th·ª±c hi·ªán</option>
                        <option value="Ho√†n th√†nh">Ho√†n th√†nh</option>
                        <option value="T·∫°m d·ª´ng">T·∫°m d·ª´ng</option>
                    </select>
                    <div style="display:flex; gap:12px; justify-content:flex-end;">
                        <button type="button" class="btn-detail" id="btn-cancel-project" style="background:#aaa;">Hu·ª∑</button>
                        <button type="submit" class="btn-detail" id="btn-save-project">L∆∞u</button>
                    </div>
                </form>
            </div>
        </main>
    </div>
    <script>
    // Sidebar toggle logic
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    sidebarToggle.addEventListener('click', function() {
        sidebar.classList.toggle('sidebar-closed');
        if (sidebar.classList.contains('sidebar-closed')) {
            sidebar.style.marginLeft = '-250px';
        } else {
            sidebar.style.marginLeft = '0';
        }
    });

    // Project CRUD logic
    const projectModal = document.getElementById('project-modal');
    const btnAddProject = document.getElementById('btn-add-project');
    const btnCancelProject = document.getElementById('btn-cancel-project');
    const projectForm = document.getElementById('project-form');
    const projectTableBody = document.getElementById('project-table-body');
    let editProjectIdx = null;
    let PROJECTS_PER_PAGE = 10;
    let projectCurrentPage = 1;

    let projects = [
        { name: 'Qu·∫£n l√≠ LAB', start: '2025-06-03', end: '2025-08-06', progress: 100, status: 'Ho√†n th√†nh' },
        { name: 'H·ªá th·ªëng m∆∞·ª£n thi·∫øt b·ªã', start: '2025-05-01', end: '2025-07-01', progress: 60, status: 'ƒêang th·ª±c hi·ªán' },
        { name: 'N√¢ng c·∫•p ph√≤ng m√°y', start: '2025-04-10', end: '2025-06-30', progress: 30, status: 'T·∫°m d·ª´ng' },
        { name: 'Ph√°t tri·ªÉn ph·∫ßn m·ªÅm qu·∫£n l√Ω', start: '2025-03-01', end: '2025-05-30', progress: 80, status: 'ƒêang th·ª±c hi·ªán' },
        { name: 'B·∫£o tr√¨ h·ªá th·ªëng m·∫°ng', start: '2025-02-15', end: '2025-04-15', progress: 100, status: 'Ho√†n th√†nh' },
        { name: 'ƒê√†o t·∫°o nh√¢n vi√™n m·ªõi', start: '2025-01-10', end: '2025-03-10', progress: 100, status: 'Ho√†n th√†nh' },
        { name: 'Ki·ªÉm k√™ thi·∫øt b·ªã', start: '2025-05-01', end: '2025-06-01', progress: 50, status: 'ƒêang th·ª±c hi·ªán' },
        { name: 'M·ªü r·ªông ph√≤ng LAB', start: '2025-04-01', end: '2025-07-01', progress: 20, status: 'T·∫°m d·ª´ng' },
        { name: 'T·ªëi ∆∞u h√≥a quy tr√¨nh', start: '2025-03-15', end: '2025-05-15', progress: 100, status: 'Ho√†n th√†nh' },
        { name: 'Nghi√™n c·ª©u c√¥ng ngh·ªá m·ªõi', start: '2025-02-01', end: '2025-04-01', progress: 70, status: 'ƒêang th·ª±c hi·ªán' },
        { name: 'D·ª± √°n th·ª≠ nghi·ªám AI', start: '2025-01-05', end: '2025-03-05', progress: 100, status: 'Ho√†n th√†nh' },
        { name: 'C·∫£i ti·∫øn b·∫£o m·∫≠t', start: '2025-06-01', end: '2025-08-01', progress: 10, status: 'ƒêang th·ª±c hi·ªán' },
    ];

    function renderProjectTable() {
        const totalPages = Math.ceil(projects.length / PROJECTS_PER_PAGE) || 1;
        if (projectCurrentPage > totalPages) projectCurrentPage = totalPages;
        const start = (projectCurrentPage - 1) * PROJECTS_PER_PAGE;
        const end = start + PROJECTS_PER_PAGE;
        projectTableBody.innerHTML = '';
        projects.slice(start, end).forEach((project, idx) => {
            let statusColor = '#2ed47a';
            if (project.status === 'T·∫°m d·ª´ng') statusColor = '#f1c40f';
            if (project.status === 'ƒêang th·ª±c hi·ªán') statusColor = '#2a7be4';
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${start + idx + 1}</td><td>${project.name}</td><td>${project.start}</td><td>${project.end}</td><td><div style='width:80px; background:#eee; border-radius:8px; overflow:hidden;'><div style='width:${project.progress}%; background:#2a7be4; color:#fff; text-align:center; border-radius:8px; font-size:13px;'>${project.progress}%</div></div></td><td><span class='status-done' style='background:${statusColor}; color:#fff;'>${project.status}</span></td><td><button class="btn-detail btn-edit-project">S·ª≠a</button> <button class="btn-detail btn-delete-project" style="background:#e74c3c;">Xo√°</button></td>`;
            projectTableBody.appendChild(tr);
        });
        updateProjectPaginationInfo();
    }

    function updateProjectPaginationInfo() {
        const totalPages = Math.ceil(projects.length / PROJECTS_PER_PAGE) || 1;
        document.getElementById('project-page-info').innerText = `Trang ${projectCurrentPage}/${totalPages}`;
        document.getElementById('btn-project-prev-page').disabled = projectCurrentPage === 1;
        document.getElementById('btn-project-next-page').disabled = projectCurrentPage === totalPages;
    }

    document.getElementById('btn-project-prev-page').onclick = function() {
        if (projectCurrentPage > 1) {
            projectCurrentPage--;
            renderProjectTable();
        }
    };
    document.getElementById('btn-project-next-page').onclick = function() {
        const totalPages = Math.ceil(projects.length / PROJECTS_PER_PAGE) || 1;
        if (projectCurrentPage < totalPages) {
            projectCurrentPage++;
            renderProjectTable();
        }
    };

    btnAddProject.onclick = function() {
        projectForm.reset();
        document.getElementById('project-modal-title').innerText = 'Th√™m d·ª± √°n';
        projectModal.style.display = 'flex';
        editProjectIdx = null;
    };
    btnCancelProject.onclick = function() {
        projectModal.style.display = 'none';
    };
    projectTableBody.onclick = function(e) {
        if (e.target.classList.contains('btn-edit-project')) {
            const rowIdx = e.target.closest('tr').rowIndex - 1;
            const start = (projectCurrentPage - 1) * PROJECTS_PER_PAGE;
            editProjectIdx = start + rowIdx;
            const project = projects[editProjectIdx];
            document.getElementById('project-modal-title').innerText = 'S·ª≠a d·ª± √°n';
            document.getElementById('project-name').value = project.name;
            document.getElementById('project-start').value = project.start;
            document.getElementById('project-end').value = project.end;
            document.getElementById('project-progress').value = project.progress;
            document.getElementById('project-status').value = project.status;
            projectModal.style.display = 'flex';
        }
        if (e.target.classList.contains('btn-delete-project')) {
            const rowIdx = e.target.closest('tr').rowIndex - 1;
            const start = (projectCurrentPage - 1) * PROJECTS_PER_PAGE;
            const idx = start + rowIdx;
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën xo√° d·ª± √°n n√†y?')) {
                projects.splice(idx, 1);
                // N·∫øu xo√° h·∫øt trang hi·ªán t·∫°i th√¨ l√πi v·ªÅ trang tr∆∞·ªõc
                const totalPages = Math.ceil(projects.length / PROJECTS_PER_PAGE) || 1;
                if (projectCurrentPage > totalPages) projectCurrentPage = totalPages;
                renderProjectTable();
            }
        }
    };
    projectForm.onsubmit = function(e) {
        e.preventDefault();
        const name = document.getElementById('project-name').value;
        const start = document.getElementById('project-start').value;
        const end = document.getElementById('project-end').value;
        const progress = parseInt(document.getElementById('project-progress').value, 10);
        const status = document.getElementById('project-status').value;
        if (editProjectIdx !== null) {
            projects[editProjectIdx] = { name, start, end, progress, status };
        } else {
            projects.push({ name, start, end, progress, status });
            // N·∫øu th√™m v√†o trang m·ªõi th√¨ chuy·ªÉn sang trang ƒë√≥
            const totalPages = Math.ceil(projects.length / PROJECTS_PER_PAGE) || 1;
            projectCurrentPage = totalPages;
        }
        projectModal.style.display = 'none';
        renderProjectTable();
    };
    projectModal.onclick = function(e) {
        if (e.target === projectModal) projectModal.style.display = 'none';
    };
    // Kh·ªüi t·∫°o b·∫£ng l·∫ßn ƒë·∫ßu
    renderProjectTable();
    </script>
</body>
</html>
