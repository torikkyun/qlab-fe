<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω thi·∫øt b·ªã</title>
    <link rel="stylesheet" href="../css/pages/dashboard.css">
    <link rel="stylesheet" href="../css/components/header.css">
    <link rel="stylesheet" href="../css/components/sidebar.css">
    <link rel="stylesheet" href="../css/main.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar Toggle Button -->
        <button id="sidebar-toggle" class="sidebar-toggle-btn">
            <span id="sidebar-toggle-icon">‚ò∞</span>
        </button>
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header" style="white-space: nowrap; display: flex; align-items: center; gap: 8px;">
                <h2 style="white-space: nowrap; font-size: 22px; margin: 0;">Qu·∫£n l√≠ LAB</h2>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><span class="icon">üè†</span> <a href="trang chu.html" style="text-decoration:none; color:inherit;">Trang ch·ªß</a></li>
                    <li><span class="icon">üë§</span> <a href="ql nguoi dung.html" style="text-decoration:none; color:inherit;">Nh√¢n vi√™n</a></li>
                    <li class="active"><span class="icon">üñ•Ô∏è</span> <a href="trang ql thi·∫øt b·ªã.html" style="text-decoration:none; color:inherit;">Thi·∫øt b·ªã</a></li>
                    <li><span class="icon">üìÅ</span> <a href="ql du an.html" style="text-decoration:none; color:inherit;">D·ª± √°n</a></li>
                    <li><span class="icon">üîÑ</span> M∆∞·ª£n thi·∫øt b·ªã</li>
                </ul>
                <div class="sidebar-bottom">
                    <ul>
                        <li><span class="icon">‚öôÔ∏è</span> C√†i ƒë·∫∑t</li>
                        <li><span class="icon">üîì</span> ƒêƒÉng xu·∫•t</li>
                    </ul>
                </div>
            </nav>
        </aside>
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left"></div>
                <div class="header-right">
                    <span class="icon">üîî</span>
                    <span class="user-info">
                        <img src="https://randomuser.me/api/portraits/women/68.jpg" alt="avatar" class="avatar">
                        <span>Ki√™n </span>
                        <span class="role">Admin</span>
                    </span>
                </div>
            </header>
            <!-- Device Management Content -->
            <section class="dashboard">
                <h1>Qu·∫£n l√Ω thi·∫øt b·ªã</h1>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px;">
                    <h2 style="margin: 0;">Danh s√°ch thi·∫øt b·ªã</h2>
                    <button class="btn-detail" id="btn-add-device">+ Th√™m thi·∫øt b·ªã</button>
                </div>
                <!-- B·ªô l·ªçc -->
                <div style="display:flex; gap:16px; margin-bottom:16px;">
                    <select id="filter-type" class="btn-detail" style="background:#fff; color:#222; border:1px solid #ddd;">
                        <option value="">T·∫•t c·∫£ lo·∫°i</option>
                        <option value="M√°y t√≠nh">M√°y t√≠nh</option>
                        <option value="M√°y in">M√°y in</option>
                        <option value="M√°y chi·∫øu">M√°y chi·∫øu</option>
                    </select>
                    <select id="filter-status" class="btn-detail" style="background:#fff; color:#222; border:1px solid #ddd;">
                        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="ƒêang s·ª≠ d·ª•ng">ƒêang s·ª≠ d·ª•ng</option>
                        <option value="S·∫µn s√†ng">S·∫µn s√†ng</option>
                        <option value="B·∫£o tr√¨">B·∫£o tr√¨</option>
                    </select>
                </div>
                <table class="project-table" id="device-table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>T√™n thi·∫øt b·ªã</th>
                            <th>Lo·∫°i</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>V·ªã tr√≠</th>
                            <th>H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="device-table-body">
                        <!-- D·ªØ li·ªáu m·∫´u s·∫Ω ƒë∆∞·ª£c render b·∫±ng JS -->
                    </tbody>
                </table>
                <!-- Pagination Footer -->
                <div id="device-pagination-footer" style="display:flex; align-items:center; justify-content:space-between; margin-top:12px;">
                    <div id="device-page-info" style="font-weight:500;">Trang 1/1</div>
                    <div>
                        <button id="btn-device-prev-page" class="btn-detail" style="min-width:36px; padding:4px 0;">&lt;</button>
                        <button id="btn-device-next-page" class="btn-detail" style="min-width:36px; padding:4px 0;">&gt;</button>
                    </div>
                </div>
            </section>
            <!-- Modal Th√™m/S·ª≠a thi·∫øt b·ªã -->
            <div id="device-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.2); align-items:center; justify-content:center; z-index:2000;">
                <form id="device-form" style="background:#fff; padding:32px 24px; border-radius:12px; min-width:320px; max-width:90vw; box-shadow:0 2px 16px rgba(0,0,0,0.12); display:flex; flex-direction:column; gap:16px;">
                    <h3 id="device-modal-title">Th√™m thi·∫øt b·ªã</h3>
                    <input type="text" id="device-name" placeholder="T√™n thi·∫øt b·ªã" required>
                    <select id="device-type">
                        <option value="M√°y t√≠nh">M√°y t√≠nh</option>
                        <option value="M√°y in">M√°y in</option>
                        <option value="M√°y chi·∫øu">M√°y chi·∫øu</option>
                    </select>
                    <select id="device-status">
                        <option value="ƒêang s·ª≠ d·ª•ng">ƒêang s·ª≠ d·ª•ng</option>
                        <option value="S·∫µn s√†ng">S·∫µn s√†ng</option>
                        <option value="B·∫£o tr√¨">B·∫£o tr√¨</option>
                    </select>
                    <input type="text" id="device-location" placeholder="V·ªã tr√≠" required>
                    <div style="display:flex; gap:12px; justify-content:flex-end;">
                        <button type="button" class="btn-detail" id="btn-cancel-device" style="background:#aaa;">Hu·ª∑</button>
                        <button type="submit" class="btn-detail" id="btn-save-device">L∆∞u</button>
                    </div>
                </form>
            </div>
        </main>
    </div>
    <script>
    // Sidebar toggle logic
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    sidebarToggle.addEventListener('click', function() {
        sidebar.classList.toggle('sidebar-closed');
        if (sidebar.classList.contains('sidebar-closed')) {
            sidebar.style.marginLeft = '-250px';
        } else {
            sidebar.style.marginLeft = '0';
        }
    });

    // Device CRUD & Filter logic
    const deviceModal = document.getElementById('device-modal');
    const btnAddDevice = document.getElementById('btn-add-device');
    const btnCancelDevice = document.getElementById('btn-cancel-device');
    const deviceForm = document.getElementById('device-form');
    const deviceTableBody = document.getElementById('device-table-body');
    const filterType = document.getElementById('filter-type');
    const filterStatus = document.getElementById('filter-status');
    const devicePageInfo = document.getElementById('device-page-info');
    const btnDevicePrevPage = document.getElementById('btn-device-prev-page');
    const btnDeviceNextPage = document.getElementById('btn-device-next-page');
    let editDeviceIdx = null;
    let devices = [
        { name: 'PC-01', type: 'M√°y t√≠nh', status: 'ƒêang s·ª≠ d·ª•ng', location: 'Ph√≤ng 101' },
        { name: 'PC-02', type: 'M√°y t√≠nh', status: 'S·∫µn s√†ng', location: 'Ph√≤ng 102' },
        { name: 'Printer-01', type: 'M√°y in', status: 'B·∫£o tr√¨', location: 'Ph√≤ng 103' },
        { name: 'Projector-01', type: 'M√°y chi·∫øu', status: 'S·∫µn s√†ng', location: 'Ph√≤ng 104' },
        { name: 'PC-03', type: 'M√°y t√≠nh', status: 'ƒêang s·ª≠ d·ª•ng', location: 'Ph√≤ng 105' },
        { name: 'PC-04', type: 'M√°y t√≠nh', status: 'S·∫µn s√†ng', location: 'Ph√≤ng 106' },
        { name: 'Printer-02', type: 'M√°y in', status: 'ƒêang s·ª≠ d·ª•ng', location: 'Ph√≤ng 107' },
        { name: 'Projector-02', type: 'M√°y chi·∫øu', status: 'B·∫£o tr√¨', location: 'Ph√≤ng 108' },
        { name: 'PC-05', type: 'M√°y t√≠nh', status: 'S·∫µn s√†ng', location: 'Ph√≤ng 109' },
        { name: 'PC-06', type: 'M√°y t√≠nh', status: 'ƒêang s·ª≠ d·ª•ng', location: 'Ph√≤ng 110' },
    ];
    const DEVICES_PER_PAGE = 10;
    let deviceCurrentPage = 1;

    function getFilteredDevices() {
        const typeVal = filterType.value;
        const statusVal = filterStatus.value;
        return devices.filter(d =>
            (typeVal === '' || d.type === typeVal) &&
            (statusVal === '' || d.status === statusVal)
        );
    }

    function renderDeviceTable() {
        const filtered = getFilteredDevices();
        const totalPages = Math.ceil(filtered.length / DEVICES_PER_PAGE) || 1;
        if (deviceCurrentPage > totalPages) deviceCurrentPage = totalPages;
        const start = (deviceCurrentPage - 1) * DEVICES_PER_PAGE;
        const end = start + DEVICES_PER_PAGE;
        const pageDevices = filtered.slice(start, end);
        deviceTableBody.innerHTML = '';
        pageDevices.forEach((device, idx) => {
            let statusColor = '#2ed47a';
            if (device.status === 'B·∫£o tr√¨') statusColor = '#f1c40f';
            if (device.status === 'ƒêang s·ª≠ d·ª•ng') statusColor = '#2a7be4';
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${start + idx + 1}</td><td>${device.name}</td><td>${device.type}</td><td><span class="status-done" style="background:${statusColor}; color:#fff;">${device.status}</span></td><td>${device.location}</td><td><button class="btn-detail btn-edit-device">S·ª≠a</button> <button class="btn-detail btn-delete-device" style="background:#e74c3c;">Xo√°</button></td>`;
            deviceTableBody.appendChild(tr);
        });
        updateDevicePaginationInfo();
    }

    function updateDevicePaginationInfo() {
        const filtered = getFilteredDevices();
        const totalPages = Math.ceil(filtered.length / DEVICES_PER_PAGE) || 1;
        devicePageInfo.innerText = `Trang ${deviceCurrentPage}/${totalPages}`;
        btnDevicePrevPage.disabled = deviceCurrentPage === 1;
        btnDeviceNextPage.disabled = deviceCurrentPage === totalPages;
    }

    btnDevicePrevPage.onclick = function() {
        if (deviceCurrentPage > 1) {
            deviceCurrentPage--;
            renderDeviceTable();
        }
    };
    btnDeviceNextPage.onclick = function() {
        const filtered = getFilteredDevices();
        const totalPages = Math.ceil(filtered.length / DEVICES_PER_PAGE) || 1;
        if (deviceCurrentPage < totalPages) {
            deviceCurrentPage++;
            renderDeviceTable();
        }
    };

    filterType.onchange = function() {
        deviceCurrentPage = 1;
        renderDeviceTable();
    };
    filterStatus.onchange = function() {
        deviceCurrentPage = 1;
        renderDeviceTable();
    };

    btnAddDevice.onclick = function() {
        deviceForm.reset();
        document.getElementById('device-modal-title').innerText = 'Th√™m thi·∫øt b·ªã';
        deviceModal.style.display = 'flex';
        editDeviceIdx = null;
    };
    btnCancelDevice.onclick = function() {
        deviceModal.style.display = 'none';
    };
    deviceTableBody.onclick = function(e) {
        if (e.target.classList.contains('btn-edit-device')) {
            const rowIdx = e.target.closest('tr').rowIndex - 1;
            const filtered = getFilteredDevices();
            const start = (deviceCurrentPage - 1) * DEVICES_PER_PAGE;
            const device = filtered[start + rowIdx];
            // T√¨m index th·ª±c trong m·∫£ng g·ªëc
            editDeviceIdx = devices.findIndex(d => d.name === device.name && d.type === device.type && d.location === device.location);
            document.getElementById('device-modal-title').innerText = 'S·ª≠a thi·∫øt b·ªã';
            document.getElementById('device-name').value = device.name;
            document.getElementById('device-type').value = device.type;
            document.getElementById('device-status').value = device.status;
            document.getElementById('device-location').value = device.location;
            deviceModal.style.display = 'flex';
        }
        if (e.target.classList.contains('btn-delete-device')) {
            const rowIdx = e.target.closest('tr').rowIndex - 1;
            const filtered = getFilteredDevices();
            const start = (deviceCurrentPage - 1) * DEVICES_PER_PAGE;
            const device = filtered[start + rowIdx];
            const idx = devices.findIndex(d => d.name === device.name && d.type === device.type && d.location === device.location);
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën xo√° thi·∫øt b·ªã n√†y?')) {
                devices.splice(idx, 1);
                // N·∫øu xo√° h·∫øt trang hi·ªán t·∫°i th√¨ l√πi v·ªÅ trang tr∆∞·ªõc
                const totalPages = Math.ceil(getFilteredDevices().length / DEVICES_PER_PAGE) || 1;
                if (deviceCurrentPage > totalPages) deviceCurrentPage = totalPages;
                renderDeviceTable();
            }
        }
    };
    deviceForm.onsubmit = function(e) {
        e.preventDefault();
        const name = document.getElementById('device-name').value;
        const type = document.getElementById('device-type').value;
        const status = document.getElementById('device-status').value;
        const location = document.getElementById('device-location').value;
        if (editDeviceIdx !== null) {
            devices[editDeviceIdx] = { name, type, status, location };
        } else {
            devices.push({ name, type, status, location });
            // N·∫øu th√™m v√†o trang m·ªõi th√¨ chuy·ªÉn sang trang ƒë√≥
            const filtered = getFilteredDevices();
            const totalPages = Math.ceil(filtered.length / DEVICES_PER_PAGE) || 1;
            deviceCurrentPage = totalPages;
        }
        deviceModal.style.display = 'none';
        renderDeviceTable();
    };
    deviceModal.onclick = function(e) {
        if (e.target === deviceModal) deviceModal.style.display = 'none';
    };
    // Kh·ªüi t·∫°o b·∫£ng l·∫ßn ƒë·∫ßu
    renderDeviceTable();
    </script>
</body>
</html>
